#!/bin/sh
# runtest --- run "@GUILE@" w/ proper test environment
#
# Copyright (C) 2008, 2011 Thien-Thi Nguyen
#
# This file is part of Guile-PG.
#
# Guile-PG is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as
# published by the Free Software Foundation; either version 3, or
# (at your option) any later version.
#
# Guile-PG is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public
# License along with Guile-PG; see the file COPYING.  If not,
# write to the Free Software Foundation, Inc., 51 Franklin Street,
# Fifth Floor, Boston, MA  02110-1301  USA

ts="@abs_top_srcdir@"
tscm=`cd "$ts/src" ; pwd`
export tscm

PGDATABASE='guile_pg_test'
export PGDATABASE

test x"$DEBUG" = x || dopt=--debug

if [ x"$GUILE_LIBSITE" = x ] ; then
    if echo '@GUILE_LIBSITE@' | grep -F '${prefix}' >/dev/null 2>&1
        then : ; else
        echo 'ERROR: Cannot determine fake GUILE_LIBSITE value.'
        echo 'Try to set it in the environment.'
        exit 1
    fi
fi

prefix=`pwd`/fake-install
exec_prefix="@exec_prefix@"
libdir="@libdir@"
test x"$DEBUG" = x || echo GUILE_LIBSITE: @GUILE_LIBSITE@

exec ${GUILE-@GUILE@} $dopt \
    -L "@GUILE_LIBSITE@" \
    -l "$ts/test/testing.scm" \
    -s $1

# runtest ends here
